<!DOCTYPE html>
<html lang="en-GB">

<head>
<meta charset="utf-8">
<title>Get new character blocks</title>
<meta name="description" content="Generate character sections for block doc.">

<link rel="stylesheet" href="local.css">

<script src="../../uniview/descriptions.js"></script> 
<script src="../../uniview/u.js"></script>




<!-- CHANGE THIS -->
<script src="../../shared/scriptdb/limb-lif.js"></script>
<script>lang = 'lif'</script>




<script>
function makeTables (lang) {
    // make the spreadsheetRows object

    if (typeof window.spreadsheet === 'undefined') {
		console.log("Spreadsheet undefined.")
        console.log('%c' + 'Cannot find '+char+' the spreadsheet.', 'color:' + 'red' + ';font-weight:bold;')
		return
		}
    
    // make an object from the spreadsheet
    var temp = window.spreadsheet.split('\n')
    spreadsheet = ''
    window.spreadsheetRows = {}
    for (var x=0; x<temp.length; x++) {
        if (temp[x].trim() == '') continue
        var items = temp[x].split('\t')
        if (items[0] === '') continue

        window.spreadsheetRows[items[0]] = ['0']
        for (let i=1;i<items.length;i++) window.spreadsheetRows[items[0]].push(items[i])
        }
    //console.log(spreadsheetRows) 
    }
</script>
</head>

<body>
<h1>Generate details page stubs</h1>
<p>Produces stubs for codepoint descriptions in XX-details pages.</p>
<p>Input is a space-separated list of characters, generated by UniView. &nbsp;&nbsp; <label><input type="checkbox" id="sort" checked> Sort first?</label></p>

<p><textarea id="listin" placeholder="Add a list of characters here." style="height:400px;width:100%;"></textarea></p>

<p>
<button style="font-size: 150%;" onClick="
document.getElementById('out').value = makeListFromChars(document.getElementById('listin').value); 
document.getElementById('out').select()">Go</button>
</p>

<textarea id="out" style="height:400px;width:100%;"></textarea>



<script>
makeTables(lang)


function makeListFromChars (chars) {
	var charList = chars.split(' ')
    
    if (document.getElementById('sort').checked) charList = charList.sort()
    
	var out = ''
	
    for (var x=0; x<charList.length; x++) {
        if (charList[x] == '') continue
        var items = charList[x].split('\t')
        
        // get code point value, converting escapes if necessary
        if (items[0].includes('&#x')) {
            items[0] = items[0].replace('&#x','').replace(';','')
            i = parseInt(items[0],16)
            }
		else i = items[0].codePointAt(0)
		console.log('i',i, 'items',items)

        var hex = i.toString(16).toUpperCase()
        while (hex.length < 4) hex = '0' + hex
        console.log(hex)

        out += "'\\u{"+hex+"}': `\n"
        out += '<p class="insertTranscription">&#x'+hex+';</p>\n'
        
        if (spreadsheetRows[charList[x]] && spreadsheetRows[charList[x]][2]) {
            ipas = spreadsheetRows[charList[x]][2].split(' ')
            
            for (i=0;i<ipas.length;i++) {
                
            
                out +=
            `\n<p><span class="ipa h">${ ipas[i] }</span> ${ spreadsheetRows[charList[x]][9] }.</p>
<p><span class="eg" lang="${ lang }"></span></p>
<p><span class="eg" lang="${ lang }"></span></p>
<p><span class="eg" lang="${ lang }"></span></p>`

                
                // check for combinations
                combinations = ''
                for (comb in spreadsheetRows) {
                    if ([...comb].length > 1 && comb.includes(charList[x]) && spreadsheetRows[comb][2]) {
                        console.log(comb,'>>',spreadsheetRows[comb][2])
                        combinations += `\n<p><span class="ipa h">${ spreadsheetRows[comb][2] }</span> is <span class="ch">${ comb }</span></p>\n`
                        }
                    }
                if (combinations) out += `\n\n<p class="leadin">Combinations</p>${ combinations }`
                }
            }
        out += '\n`,\n\n\n\n\n\n'
		}
	return out
	}

</script>
<p><span class="ipa h"></span> consonant.</p>
<p><span class="eg" lang="lis"></span></p>
<p><span class="eg" lang="lis"></span></p>
<p><span class="eg" lang="lis"></span></p>
<p><span class="eg alt" lang="lis"></span></p>

</body>
</html>
